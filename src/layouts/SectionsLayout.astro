---
type Section = "architecture" | "photo" | "info";
type Lang = "it" | "en";

export interface Props {
	title: string;
	section: Section;
	lang?: Lang;
}

const { title, section, lang = "it" } = Astro.props;

const EMAIL = "isidoro.pannitti@gmail.com";
const INSTAGRAM_HANDLE = "@_isoradio";
const INSTAGRAM_URL = "https://www.instagram.com/_isoradio/";

const navLabels: Record<Lang, Record<Section, string>> = {
	it: {
		architecture: "architettura",
		photo: "foto",
		info: "info",
	},
	en: {
		architecture: "architecture",
		photo: "photo",
		info: "info",
	},
};

const prefix = lang === "en" ? "/en" : "";
const getSectionHref = (target: Section) => {
	if (target === "architecture") {
		return prefix || "/";
	}

	return `${prefix}/${target}`;
};

const pathname = Astro.url.pathname;
const englishPath = pathname.startsWith("/en") ? pathname : `/en${pathname === "/" ? "" : pathname}`;
const italianPath = pathname.startsWith("/en") ? pathname.slice(3) || "/" : pathname;
const switchHref = lang === "it" ? englishPath : italianPath;
---

<html lang={lang}>
	<head>
		<meta charset="utf-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1" />
		<link rel="preconnect" href="https://fonts.googleapis.com" />
		<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
		<link
			href="https://fonts.googleapis.com/css2?family=Cormorant:ital,wght@0,300;1,300&family=Work+Sans:ital,wght@0,300;1,300&display=swap"
			rel="stylesheet"
		/>
		<link rel="icon" type="image/svg+xml" href="/favicon.svg?v=ip2" />
		<link rel="shortcut icon" href="/favicon.svg?v=ip2" />
		<title>{title}</title>
		<style>
			:root {
				color-scheme: light;
				--edge: clamp(1.25rem, 3vw, 2.5rem);
			}

			* {
				box-sizing: border-box;
			}

			html,
			body {
				margin: 0;
				padding: 0;
				background: #fff;
				color: #000;
				font-family: "Work Sans", sans-serif;
				font-weight: 300;
				font-size: clamp(0.98rem, 1.05vw, 1rem);
				line-height: 1.45;
			}

			a {
				color: inherit;
				text-decoration: none;
				transition: opacity 140ms ease;
			}

			a:hover,
			a:focus-visible {
				opacity: 0.68;
			}

			.left-fixed,
			.right-fixed {
				position: fixed;
				top: var(--edge);
				z-index: 10;
			}

			.menu-toggle {
				position: fixed;
				opacity: 0;
				pointer-events: none;
			}

			.left-fixed {
				left: var(--edge);
				display: grid;
				gap: 0.12rem;
				text-transform: lowercase;
				transition: transform 280ms ease, opacity 240ms ease;
			}

			.left-fixed p {
				margin: 0;
			}

			.site-home {
				display: inline-block;
			}

			.right-fixed {
				right: var(--edge);
				text-transform: lowercase;
				display: flex;
				align-items: center;
				justify-content: flex-end;
				gap: 0.5rem;
			}

			.sections-nav {
				display: flex;
				align-items: center;
				gap: 0;
			}

			.right-fixed .active {
				font-style: italic;
			}

			.menu-trigger {
				display: none;
				cursor: pointer;
				user-select: none;
				font-size: 1.3em;
				line-height: 1;
				transition: opacity 220ms ease, transform 260ms ease;
			}

			main {
				min-height: 100vh;
				padding: clamp(6.9rem, 17vh, 9.5rem) var(--edge) 2rem;
			}

			.lang-switch-fixed {
				position: fixed;
				right: var(--edge);
				bottom: var(--edge);
				z-index: 20;
				color: #b9b9b9;
				transition: opacity 180ms ease;
			}

			.lang-switch-fixed.is-hidden {
				opacity: 0;
				pointer-events: none;
			}

			.lang-switch-fixed a {
				color: inherit;
				text-transform: lowercase;
			}

			.lang-switch-fixed .active {
				color: #9b9b9b;
			}

			@media (max-width: 980px) {
				html,
				body {
					font-size: clamp(0.88rem, 3.5vw, 0.95rem);
				}

				.menu-trigger {
					display: inline-flex;
				}

				.sections-nav {
					max-width: 0;
					overflow: hidden;
					transform: translateX(0.45rem);
					opacity: 0;
					pointer-events: none;
					transition: transform 280ms ease, opacity 240ms ease, max-width 280ms ease,
						margin-right 280ms ease;
					margin-right: 0;
					white-space: nowrap;
				}

				.menu-toggle:checked ~ .left-fixed {
					transform: translateX(-1.9rem);
					opacity: 0.4;
				}

				.menu-toggle:checked ~ .right-fixed .sections-nav {
					transform: translateX(0);
					opacity: 1;
					pointer-events: auto;
					max-width: 92vw;
					margin-right: 0.5rem;
				}
			}
		</style>
	</head>
	<body>
		<input class="menu-toggle" type="checkbox" id="sections-toggle" />

		<div class="left-fixed">
			<p>
				<a class="site-home" href={prefix || "/"}>isidoro pannitti architetto</a>
			</p>
			<p>
				<a href={`mailto:${EMAIL}`}>{EMAIL}</a>
			</p>
			<p>
				<a href={INSTAGRAM_URL} target="_blank" rel="noreferrer noopener">{INSTAGRAM_HANDLE}</a>
			</p>
		</div>

		<div class="right-fixed">
			<nav class="sections-nav" aria-label="Sections">
				<a class:list={{ active: section === "architecture" }} href={getSectionHref("architecture")}
					>{navLabels[lang].architecture}</a
				>
				<span>,&nbsp;</span>
				<a class:list={{ active: section === "photo" }} href={getSectionHref("photo")}
					>{navLabels[lang].photo}</a
				>
				<span>,&nbsp;</span>
				<a class:list={{ active: section === "info" }} href={getSectionHref("info")}
					>{navLabels[lang].info}</a
				>
			</nav>
			<label class="menu-trigger" for="sections-toggle">+</label>
		</div>

		<div class="lang-switch-fixed" data-lang-switch>
			<a href={switchHref}>
				<span class:list={{ active: lang === "it" }}>it</span>/<span class:list={{ active: lang === "en" }}
					>en</span
				>
			</a>
		</div>

		<main>
			<slot />
		</main>

		<script is:inline>
			(() => {
				const langSwitch = document.querySelector("[data-lang-switch]");
				if (!langSwitch) return;

				let revealTimer;
				const hide = () => langSwitch.classList.add("is-hidden");
				const showLater = () => {
					clearTimeout(revealTimer);
					revealTimer = window.setTimeout(() => {
						langSwitch.classList.remove("is-hidden");
					}, 700);
				};

				const onScrollIntent = () => {
					hide();
					showLater();
				};

				window.addEventListener("wheel", onScrollIntent, { passive: true });
				window.addEventListener("touchmove", onScrollIntent, { passive: true });
				document.addEventListener("scroll", onScrollIntent, { passive: true, capture: true });
			})();
		</script>
	</body>
</html>
